<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="user_mapper">

    <!-- ðŸ“Œ ì „ì²´ ì‚¬ìš©ìž ëª©ë¡ ì¡°íšŒ -->
    <select id="findUserList" resultType="com.app.dto.user.User">
        SELECT * FROM USERS
    </select>

    <!-- ðŸ“Œ ID ê¸°ë°˜ ì‚¬ìš©ìž ì¡°íšŒ -->
    <select id="findUserById" parameterType="String" resultType="com.app.dto.user.User">
        SELECT * FROM USERS WHERE id = #{id}
    </select>

    <!-- ðŸ“Œ ì´ë©”ì¼ ê¸°ë°˜ ì‚¬ìš©ìž ì¡°íšŒ (ë¡œê·¸ì¸ ì‹œ ì‚¬ìš©) -->
    <select id="findByEmail" parameterType="String" resultType="com.app.dto.user.User">
        SELECT * FROM USERS WHERE email = #{email}
    </select>

    <!-- ðŸ“Œ íšŒì›ê°€ìž… (ìƒˆë¡œìš´ ì‚¬ìš©ìž ì €ìž¥) -->
    <insert id="saveUser" parameterType="com.app.dto.user.User">
        INSERT INTO USERS (id, email, pw, name, tel, jumin, position_code, dept_code, created_at, updated_at, cmp_id)
        VALUES (USERS_PK.NEXTVAL, #{email}, #{pw}, #{name}, #{tel}, #{jumin}, #{position_code}, #{dept_code}, SYSTIMESTAMP, SYSTIMESTAMP, #{cmp_id})
    </insert>

    <!-- ðŸ“Œ ì‚¬ìš©ìž ì •ë³´ ìˆ˜ì • -->
    <update id="modifyUser" parameterType="com.app.dto.user.User">
        UPDATE USERS
        SET pw = #{pw}, name = #{name}, tel = #{tel}, jumin = #{jumin}, position_code = #{position_code}, 
            dept_code = #{dept_code}, updated_at = SYSTIMESTAMP
        WHERE id = #{id}
    </update>

    <!-- ðŸ“Œ ì‚¬ìš©ìž ë¡œê·¸ì¸ í™•ì¸ -->
    <select id="checkUserLogin" parameterType="com.app.dto.user.User" resultType="com.app.dto.user.User">
        SELECT * FROM USERS WHERE email = #{email} AND pw = #{pw}
    </select>

    <!-- ðŸ“Œ ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬ -->
    <select id="isEmailCheck" parameterType="String" resultType="int">
        SELECT COUNT(*) FROM USERS WHERE email = #{email}
    </select>

    <!-- ðŸ“Œ ê²€ìƒ‰ ì¡°ê±´ ê¸°ë°˜ ì‚¬ìš©ìž ëª©ë¡ ì¡°íšŒ -->
    <select id="findUserListBySearchCondition" parameterType="com.app.dto.user.UserSearchCondition" resultType="com.app.dto.user.User">
        SELECT * FROM USERS
        WHERE 
            (#{name} IS NULL OR name LIKE '%' || #{name} || '%')
            AND (#{email} IS NULL OR email LIKE '%' || #{email} || '%')
            AND (#{position_code} IS NULL OR position_code = #{position_code})
            AND (#{dept_code} IS NULL OR dept_code = #{dept_code})
    </select>

</mapper>
